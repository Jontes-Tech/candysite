---
import type { ArtStationData } from "../types";

// This is ran at build time on the server
const response = await fetch(
  "https://www.artstation.com/users/candycaneannihalator/projects.json"
).then((res) => res.json());

const projects: ArtStationData[] = response.data;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/me.png" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>CandyCane</title>
    <link rel="preconnect" href="https://fonts.bunny.net" />
    <link
      href="https://fonts.bunny.net/css?family=vt323:400"
      rel="stylesheet"
    />
    <meta name="description" content="CandyCane's Portfolio" />
    <meta property="og:title" content="CandyCane" />
    <meta property="og:description" content="CandyCane's Portfolio" />
    <meta property="creator" content="Jonte from Jontes.Page" />
  </head>
  <body class="bg-background">
    <section id="hero">
      <h1 class="font-pixel text-[6vw] text-primary text-center font-black">
        CandyCane
      </h1>
    </section>
    <section
      class="mx-auto max-w-4xl bg-card grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 p-4 rounded-2xl"
    >
      {
        projects.map((project: ArtStationData, index: number) => (
          <div class="mx-auto">
            <img
              class="object-cover galleryIMG bg-primary h-[277.33333px] shadow-sm w-[277.33333px] rounded-3xl hover:rounded-lg transition-all"
              src={project.cover.small_square_url}
              alt={project.title}
              title={"Click to view " + project.title}
              fetchpriority={index > 5 ? "low" : "high"}
              onclick="
              document.getElementById('modal').showModal(); document.getElementById('modal').querySelector('h2').innerText = this.alt; document.getElementById('modal').querySelector('img').src = this.src;
              "
            />
          </div>
        ))
      }
    </section>
    <div
      id="acceptable-sponsored-content"
      class="mx-auto max-w-4xl bg-primaryMuted my-8 p-2 rounded text-white"
    >
      <!-- Chip that says "ad" -->
      <div
        class="bg-primary text-xs font-bold rounded-full px-2 py-1 inline-block"
      >
        Ad
      </div>
      Acceptable ad spot available. Contact jonatan+candyads [at] jontes [dot] page
      for more information.
    </div>

    <footer class="text-center text-white text-sm my-4">
      <p>
        Made with{" "}
        <span role="img" aria-label="love"> ❤️</span>{" "}
        by{" "}
        <a
          href="https://jontes.page?utm_source=candycane&utm_medium=footer&utm_campaign=portfolio"
          rel="nofollow"
          target="_blank"
          class="underline"
        >
          Jonte
        </a>
        {" "} for CandyCane
      </p>
    </footer>
    <dialog id="modal" class="bg-modal text-white shadow-md rounded-2xl p-4">
      <button
        id="close-modal"
        class="absolute top-2 right-2 text-gray-500 hover:text-gray-700"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
      <h2 class="text-lg font-medium mb-4"></h2>
      <!-- This modal focuses on the image, make it glorious -->
      <img class="mx-auto" src="" alt="" />
    </dialog>
  </body>
</html>
<script>
  document.getElementById("close-modal")?.addEventListener("click", () => {
    // @ts-expect-error
    document.getElementById("modal")?.close();
  });
</script>
